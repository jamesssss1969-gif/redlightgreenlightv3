<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Red Light Green Light</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .panel {
      background: #020617;
      padding: 20px;
      border-radius: 14px;
      width: 380px;
      max-width: 95vw;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }
    h1 { text-align: center; margin-top: 0; }
    .section { margin-bottom: 16px; }
    label { font-size: 0.85rem; color: #cbd5f5; }
    .lights {
      display: flex;
      justify-content: space-around;
      margin: 18px 0 10px;
    }
    .light {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #1f2937;
      opacity: 0.25;
      transition: background 0.3s, opacity 0.3s, box-shadow 0.3s;
    }
    .light.red.active { background:#ef4444; opacity:1; box-shadow:0 0 25px rgba(239,68,68,0.8);}    
    .light.green.active { background:#22c55e; opacity:1; box-shadow:0 0 25px rgba(34,197,94,0.8);}    
    .light.amber.active { background:#f59e0b; opacity:1; box-shadow:0 0 25px rgba(245,158,11,0.9);}    
    #message { text-align:center; min-height:48px; font-size:1.1rem; font-weight:600; margin-bottom:10px; }
    button {
      width:100%; padding:12px; border-radius:999px; border:none; background:#1d4ed8; color:white;
      font-size:1rem; font-weight:600; cursor:pointer; margin-top:10px;
    }
    button.secondary { background:#374151; }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .hint { font-size:0.75rem; color:#94a3b8; margin-top:4px; }
    .stopwatch { text-align:center; font-size:0.9rem; color:#9ca3af; }
  </style>
</head>
<body>
<div class="panel">
  <h1>Red Light Green Light</h1>

  <div class="section">
    <label>Red durations (s)</label>
    <div class="row">
      <label><input type="checkbox" class="redDur" value="5" checked>5</label>
      <label><input type="checkbox" class="redDur" value="10">10</label>
      <label><input type="checkbox" class="redDur" value="15">15</label>
      <label><input type="checkbox" class="redDur" value="20">20</label>
      <label><input type="checkbox" class="redDur" value="25">25</label>
      <label><input type="checkbox" class="redDur" value="30">30</label>
    </div>
  </div>

  <div class="section">
    <label>Green durations (s)</label>
    <div class="row">
      <label><input type="checkbox" class="greenDur" value="5">5</label>
      <label><input type="checkbox" class="greenDur" value="10">10</label>
      <label><input type="checkbox" class="greenDur" value="15" checked>15</label>
      <label><input type="checkbox" class="greenDur" value="20">20</label>
      <label><input type="checkbox" class="greenDur" value="25">25</label>
      <label><input type="checkbox" class="greenDur" value="30">30</label>
    </div>
  </div>

  <div class="section">
    <label><input type="checkbox" id="punishToggle" checked> Enable punishments</label>
    <div class="hint">10% chance after a red light</div>
  </div>

  <div class="section">
    <label>Personality</label>
    <div class="row">
      <label><input type="radio" name="persona" value="authority" checked> Authority</label>
      <label><input type="radio" name="persona" value="encouraging"> Encouraging</label>
    </div>
  </div>

  <div class="lights">
    <div id="red" class="light red"></div>
    <div id="amber" class="light amber"></div>
    <div id="green" class="light green"></div>
  </div>

  <div id="message"></div>
  <div class="stopwatch" id="stopwatch">00:00</div>

  <button id="startBtn">Start</button>
  <button id="readyBtn" class="secondary" disabled>Ready to Cum</button>
  <button id="resetBtn" class="secondary">Reset</button>
</div>

<script>
let phase=null, timer=null, stopwatchTimer=null, secondsElapsed=0;
let rtcActive=false, rtcSeconds=0, rtcInterval=null;

const authorityRed=["Control yourself","Hands off","You need discipline","Not yet","Wait"];
const encouragingRed=["Easy now","Hold it","Stay still","Breathe","Wait"];
const greenTexts=["Go","Keep moving","Steady","Don't stop"];
const punishments=["Hold still","Hands up","Freeze","Stay put"];

function beep(type){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const o=ctx.createOscillator(), g=ctx.createGain();
  o.connect(g).connect(ctx.destination);
  o.type='sine';
  o.frequency.value = type==='green'?700: type==='amber'?520:360;
  g.gain.setValueAtTime(0.25, ctx.currentTime);
  o.start(); o.stop(ctx.currentTime+0.25);
}

function pickChecked(cls){
  const v=[...document.querySelectorAll('.'+cls+':checked')].map(c=>+c.value);
  return v.length? v[Math.floor(Math.random()*v.length)] : 5;
}
function clearLights(){['red','green','amber'].forEach(id=>document.getElementById(id).classList.remove('active'));}
function persona(){return document.querySelector('input[name="persona"]:checked').value;}
function redMessage(){return (persona()==='authority'?authorityRed:encouragingRed)[Math.floor(Math.random()*5)];}

function setPhase(p,dur){
  phase=p; clearLights(); document.getElementById(p).classList.add('active'); beep(p);
  if(p==='red') message.textContent=redMessage();
  if(p==='green') message.textContent=greenTexts[Math.floor(Math.random()*greenTexts.length)];
  if(p==='amber') message.textContent=punishments[Math.floor(Math.random()*punishments.length)];
  timeLeft=dur;
}

let timeLeft=0;
function nextPhase(){
  if(phase==='red'){
    if(punishToggle.checked && Math.random()<0.1){ setPhase('amber',10); return; }
    setPhase('green', pickChecked('greenDur'));
  } else if(phase==='green'){
    setPhase('red', pickChecked('redDur'));
  } else if(phase==='amber'){
    setPhase('green', pickChecked('greenDur'));
  }
}
function tick(){ timeLeft--; if(timeLeft<=0) nextPhase(); }

function startStopwatch(){
  stopwatchTimer=setInterval(()=>{
    secondsElapsed++;
    const m=String(Math.floor(secondsElapsed/60)).padStart(2,'0');
    const s=String(secondsElapsed%60).padStart(2,'0');
    stopwatch.textContent=`${m}:${s}`;
  },1000);
}

function start(){ if(timer) return; setPhase('red', pickChecked('redDur')); timer=setInterval(tick,1000); startStopwatch(); readyBtn.disabled=false; }
function reset(){
  clearInterval(timer); clearInterval(stopwatchTimer); clearInterval(rtcInterval);
  timer=null; stopwatchTimer=null; rtcInterval=null; rtcActive=false; secondsElapsed=0; rtcSeconds=0; phase=null;
  clearLights(); message.textContent=''; stopwatch.textContent='00:00'; readyBtn.disabled=true;
}

function readyToCum(){
  if(rtcActive) return;
  rtcActive=true; clearInterval(timer); clearInterval(rtcInterval);
  rtcSeconds=0; message.textContent='';

  const rtcTick=()=>{
    rtcSeconds++;
    // alternate short red (5s) and green (15s) during RTC
    const cycle = rtcSeconds % 20; // 5 red + 15 green
    if(cycle===1){ setPhase('red',5); }
    if(cycle===6){ setPhase('green',15); }

    if(rtcSeconds>=60){
      clearInterval(rtcInterval);
      // decision at end of 60s
      if(Math.random()<0.5){
        clearLights(); document.getElementById('green').classList.add('active'); beep('green');
        message.textContent='Cum now';
      } else {
        clearLights(); document.getElementById('amber').classList.add('active'); beep('amber');
        message.textContent='Denied';
        setTimeout(()=>{ rtcSeconds=0; rtcInterval=setInterval(rtcTick,1000); }, 2000);
      }
    }
  };

  // start immediately with green
  setPhase('green',15);
  rtcInterval=setInterval(rtcTick,1000);
}

startBtn.onclick=start; resetBtn.onclick=reset; readyBtn.onclick=readyToCum;
</script>
</body>
</html>
